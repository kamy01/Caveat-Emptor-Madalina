<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewParam name="userId" value="#{itemsBean.userId}"
			converter="javax.faces.Long"></f:viewParam>
	</f:metadata>

	<p:layout style="width:100%;height:600px;">
 
		<p:layoutUnit position="center">
			<div id="wrapper_create_item">
				<div id="container_create_item">
					<h:form id="frmDropDown" style="padding-left:15px;">
						<p:outputLabel for="dropDownItems" value="Items to: " />
						<h:selectOneMenu id="dropDownItems" value="#{itemsBean.optionDropDown}">
							<f:selectItem itemLabel=" Sell " itemValue="sell" />
							<f:selectItem itemLabel=" Buy " itemValue="buy" />
							<p:ajax event="change"
								update="tabView:frmDropDown:frmContentItems:dataTableItems"
								process="@this" listener="#{itemsBean.onDropDownChange}" />
						</h:selectOneMenu>
						
						<p:commandButton value="Create new item" action="#{itemsBean.insertItem}" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
						

						<h:form id="frmContentItems" style="padding-left:15px;">
							<h:outputText for="createItem" value="     " />

							<br />
							<br />
					
							<p:dataTable id="dataTableItems" var="item" rows="10" paginator="true"
								value="#{itemsBean.itemsListDto}" sortMode="multiple"  editable="true">
								
								<p:ajax event="rowEdit" listener="#{itemsBean.onRowEdit}" 	process="@this" update="tabView:frmDropDown:frmContentItems:dataTableItems" onerror="PF('dlgVarEdit').hide()"/>
 								<p:ajax event="rowEditCancel" listener="#{itemsBean.onRowCancel}" process="@this" update="tabView:frmDropDown:frmContentItems:dataTableItems tabView:frmDropDown:frmContentItems:dataTableItems:message"/>
       
								<f:facet name="header">
           							Items to #{itemsBean.optionDropDown}
       							 </f:facet>

								<p:column headerText="Name" sortBy="#{item.name}">
								<p:cellEditor >
								  <h:outputText value="#{item.name}"/>
									<f:facet name="output"><h:outputText value="#{item.name}"/></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputName" value="#{item.name}" style="width:96%" required="true" requiredMessage="Empty Name column.Value is required!" label="Name" >	
                 					</p:inputText>
                 					
                 					</f:facet>
								</p:cellEditor>
								</p:column>


							<p:column headerText="Categories" sortBy="#{item.categories}">
								<p:cellEditor>
									<f:facet name="output">
									<h:outputText value="#{item.categories}" />
									</f:facet>
									
                 					<f:facet name="input">
                 					<h:selectOneMenu id="dropDownCategories" value="#{item.categories}">
                 					
                 					  	<f:selectItems value="#{itemsBean.category}" var="categ" itemValue="#{categ}" itemLabel="#{categ}" />
   
									</h:selectOneMenu>
                 					</f:facet>

								</p:cellEditor>
								</p:column>			
								
								<p:column headerText="Initial price (€)" sortBy="#{item.initialPrice}" >
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.initialPrice}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputInitialPrice" value="#{item.initialPrice}" style="width:96%" requiredMessage="Wrong format for Initial price column.Only digits are allowed!" label="InitialPrice" >			
                 					</p:inputText>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Best bid (€)" sortBy="#{item.bestBid}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.bestBid}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputBestBid" value="#{item.bestBid}" style="width:96%" requiredMessage="Wrong format for Best Bid column.Only digits are allowed!" label="BestBid" >				
                 					</p:inputText>
                 					</f:facet>
								</p:cellEditor>
								</p:column>
								
								<p:column headerText="My bid (€)" sortBy="#{item.yourBid}" rendered="#{itemsBean.renderedMyBid}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.yourBid}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputYourBid" value="#{item.yourBid}" style="width:96%" requiredMessage="Wrong format for My Bid column.Only digits are allowed!" label="myBid" >
                 					 </p:inputText>      		
                 					</f:facet>
                 					
								</p:cellEditor>
								
								</p:column>

								<p:column headerText="Bids" sortBy="#{item.nrBids}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.nrBids}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputNrBids" value="#{item.nrBids}" style="width:96%" requiredMessage="Wrong format for Bids column.Only numbers are allowed!" label="bids"  >			
                 					</p:inputText>
                 					</f:facet>
								
								</p:cellEditor>
								</p:column>

								<p:column headerText="Opening date" sortBy="#{item.biddingStartDate}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.biddingStartDate}" /></f:facet>
                 					<f:facet name="input">
                 					<p:calendar id="modelInputBiddingStartDate" required="true" value="#{item.biddingStartDate}" style="width:96%" pattern="MM/dd/yyyy" requiredMessage="Empty Opening date column.Select a date!" label="openingDate" >
                 					</p:calendar>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Closing date" sortBy="#{item.biddingEndDate}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.biddingEndDate}" /></f:facet>
                 					<f:facet name="input">
                 					<p:calendar id="modelInputBiddingEndDate" required="true" value="#{item.biddingEndDate}" style="width:96%" pattern="MM/dd/yyyy" requiredMessage="Empty Closing date column.Select a date!" label="closingDate">
                 					</p:calendar>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Status" sortBy="#{item.status}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.status}" /></f:facet>
                 					<f:facet name="input"><p:inputText id="modelInputBiddingStatus" value="#{item.status}" style="width:96%"/></f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Winner" sortBy="#{item.winner}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.winner}" /></f:facet>
                 					<f:facet name="input"><p:inputText id="modelInputWinner" value="#{item.winner}" style="width:96%"/></f:facet>
								</p:cellEditor>
								</p:column>
								
								<p:column style="width:50px">
								
							
								<p:rowEditor rendered="#{item.renderedEdit}" id="editor">   
								</p:rowEditor >
								
   				 				<p:growl id="message" showDetail="false"/>   				 							
								<p:dialog id="dialogEdit" height="150" width="300" widgetVar="dlgVarEdit" closable="true">
								<div>
								<br/>
									 	<h:outputText style="margin-left:10px;" value=" Do you want to update this item ?"/>
									 			 <br/><br/><br/>
									 	<p:commandButton value="Yes" action="#{itemsBean.updateItem}" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
       									<h:outputText value=" "/>
       									<p:commandButton value="No" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
								
								</div>
							 	</p:dialog>
							 	
 								
									<p:dialog id="dlgVarInsert" height="150" width="300" widgetVar="dlgVarInsert" >
 								<div>
									<br/>
									 	<h:outputText style="margin-left:10px;" value=" Do you want to insert a new item ?"/>
									 			 <br/><br/><br/>
									 			
											<h:form id="newItemForm">
									 				<h:outputText value="Name"/>
									 				<p:inputText id="nameNew" value="#{itemsBean.itemDto.name}" >
									 				</p:inputText>
									 					<h:outputText value="Description"/>
									 				<p:inputTextarea id="descriptionNew" value="#{itemsBean.itemDto.description}" >
									 				</p:inputTextarea>
									 				
									 				<h:outputText value="Initial price (€)"/>
									 				<p:inputText id="initialPrice" value="#{itemsBean.itemDto.initialPrice}" required="true" requiredMessage="Initial price is required">
									 				</p:inputText>
									 				
								
									 				<h:outputText value="Closing date"/>
									 				<p:calendar id="closingDate" value="#{itemsBean.itemDto.biddingEndDate}" required="true" requiredMessage="Closing date is required" pattern="MM/dd/yyyy">
									 				</p:calendar>
									 				
									 				<p:commandButton value="Yes"  >
									 					<p:ajax listener="#{itemsBean.insert}"
														update=":tabView:frmDropDown:frmContentItems:dataTableItems"
														process="@form"></p:ajax>
									 				</p:commandButton>
       									<h:outputText value=" "/>
       									<p:commandButton value="No" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
								
									 		</h:form>
									 	
									</div>
									</p:dialog>
									
							    </p:column>
							</p:dataTable>
						</h:form>
					</h:form>
				</div>
			</div>
				
		</p:layoutUnit>
		<p:layoutUnit position="south">

		</p:layoutUnit>
	</p:layout>
</ui:composition>