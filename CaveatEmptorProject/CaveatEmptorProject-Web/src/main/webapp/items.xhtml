<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">


	<f:metadata>
		<f:viewParam name="userId" value="#{itemsBean.userId}"
			converter="javax.faces.Long"></f:viewParam>
	</f:metadata>

	<p:layout style="width:100%;height:600px;">

		<p:layoutUnit position="center">
			<div id="wrapper_create_item">
				<div id="container_create_item">


					<h:form id="form">
						<p:outputLabel for="dropDownItems" value="Items to: " />
						<h:selectOneMenu id="dropDownItems"
							value="#{itemsBean.optionDropDown}">
							<f:selectItem itemLabel=" Sell " itemValue="sell" />
							<f:selectItem itemLabel=" Buy " itemValue="buy" />
							<p:ajax event="change" update="tabView:form" process="@this"
								listener="#{itemsBean.onDropDownChange}" />
						</h:selectOneMenu>

						
						<p:commandButton value="Create new item"
							action="#{itemsBean.insertItem}">
						</p:commandButton>


						<p:dataTable id="dataTableItems" value="#{itemsBean.itemsListDto}"
							var="item" editable="true"  paginator="true" rows="10"
							 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
							<p:ajax event="rowEdit" listener="#{itemsBean.onRowEdit}"
								process="@this" update="tabView:form:dataTableItems"
								onerror="PF('dlgVarEdit').hide()" />
							<p:ajax event="rowEditCancel" listener="#{itemsBean.onRowCancel}"
								process="@this" update="tabView:form:dataTableItems:message" />

							<f:facet name="header">
           							Items to #{itemsBean.optionDropDown}
       							 </f:facet>

							<p:column headerText="Name" sortBy="#{item.name}">
								<p:cellEditor>
									<h:outputText value="#{item.name}" />
									<f:facet name="output">
										<h:outputText value="#{item.name}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputName" value="#{item.name}"
											style="width:96%" required="true"
											requiredMessage="Empty Name column.Value is required!"
											label="Name">
										</p:inputText>

									</f:facet>
								</p:cellEditor>
							</p:column>


							<p:column headerText="Categories" sortBy="#{item.categories}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.categories}" />
									</f:facet>

									<f:facet name="input">
										<h:selectOneMenu id="dropDownCategories"
											value="#{item.categories}">

											<f:selectItems value="#{itemsBean.category}" var="categ"
												itemValue="#{categ}" itemLabel="#{categ}" />

										</h:selectOneMenu>
									</f:facet>

								</p:cellEditor>
							</p:column>

							<p:column headerText="Initial price (€)"
								sortBy="#{item.initialPrice}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.initialPrice}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputInitialPrice"
											value="#{item.initialPrice}" style="width:96%"
											requiredMessage="Wrong format for Initial price column.Only digits are allowed!"
											label="InitialPrice">
										</p:inputText>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Best bid (€)" sortBy="#{item.bestBid}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.bestBid}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputBestBid" value="#{item.bestBid}"
											style="width:96%"
											requiredMessage="Wrong format for Best Bid column.Only digits are allowed!"
											label="BestBid">
										</p:inputText>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="My bid (€)" sortBy="#{item.yourBid}"
								rendered="#{itemsBean.renderedMyBid}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.yourBid}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputYourBid" value="#{item.yourBid}"
											style="width:96%"
											requiredMessage="Wrong format for My Bid column.Only digits are allowed!"
											label="myBid">
										</p:inputText>
									</f:facet>

								</p:cellEditor>

							</p:column>

							<p:column headerText="Bids" sortBy="#{item.nrBids}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.nrBids}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputNrBids" value="#{item.nrBids}"
											style="width:96%"
											requiredMessage="Wrong format for Bids column.Only numbers are allowed!"
											label="bids">
										</p:inputText>
									</f:facet>

								</p:cellEditor>
							</p:column>

							<p:column headerText="Opening date"
								sortBy="#{item.biddingStartDate}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.biddingStartDate}" />
									</f:facet>
									<f:facet name="input">
										<p:calendar id="modelInputBiddingStartDate" required="true"
											value="#{item.biddingStartDate}" style="width:96%"
											pattern="MM/dd/yyyy"
											requiredMessage="Empty Opening date column.Select a date!"
											label="openingDate">
										</p:calendar>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Closing date"
								sortBy="#{item.biddingEndDate}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.biddingEndDate}" />
									</f:facet>
									<f:facet name="input">
										<p:calendar id="modelInputBiddingEndDate" required="true"
											value="#{item.biddingEndDate}" style="width:96%"
											pattern="MM/dd/yyyy"
											requiredMessage="Empty Closing date column.Select a date!"
											label="closingDate">
										</p:calendar>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Status" sortBy="#{item.status}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.status}" />
									</f:facet>
									<f:facet name="input">
										<h:selectOneMenu id="dropDownStatus"
											value="#{item.status}">
											<f:selectItems var="statusChanged" itemValue="#{statusChanged}" itemLabel="#{statusChanged}"/>	
								</h:selectOneMenu>
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column headerText="Winner" sortBy="#{item.winner}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{item.winner}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText id="modelInputWinner" value="#{item.winner}"
											style="width:96%" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column style="width:65px">


								<p:rowEditor rendered="#{item.renderedEdit}" id="editor">
								</p:rowEditor>

								<p:growl id="message" showDetail="false" />

								<p:dialog id="dialogEdit" height="150" width="300"
									widgetVar="dlgVarEdit" closable="true">
									<div>
										<br />
										<h:outputText style="margin-left:10px;"
											value=" Do you want to update this item ?" />
										<br />
										<br />
										<br />
										<p:commandButton value="Yes" action="#{itemsBean.updateItem}"
											update="tabView:form" />
										<h:outputText value=" " />
										<p:commandButton value="No" update="tabView:form" />

									</div>
								</p:dialog>
							</p:column>
						</p:dataTable>
						<p:dialog header="Insert new item" widgetVar="itemDialog" id="itemDlg" style="margin-top:-138px;">



						<h:panelGrid id="display"  columns="4">
						
							
								<h:outputText value="Name" />
								<p:inputText id="name" value="#{itemsBean.itemDto.name}" ></p:inputText>
								
						
								
								<h:outputText value="Description" />
								<p:inputTextarea id="description"
									value="#{itemsBean.itemDto.description}"></p:inputTextarea>
							
						
									<h:outputText value="Initial price (€)" />
									<p:inputText id="initialPrice"
									value="#{itemsBean.itemDto.initialPrice}" required="true"
									requiredMessage="Initial price is required"></p:inputText>
									
								
								
								<h:outputText value="Opening date" />
								<p:calendar id="openingDate"
									value="#{itemsBean.itemDto.biddingStartDate}" required="true"
									requiredMessage="Opening date is required" pattern="MM/dd/yyyy" widgetVar="startDateCalendar" >
									</p:calendar>
									<h:outputText value="" />
									<h:outputText value="" />
							
								<h:outputText value="Closing date"/>
							
								<p:calendar id="closingDate"
									value="#{itemsBean.itemDto.biddingEndDate}" required="true"
									requiredMessage="Closing date is required" pattern="MM/dd/yyyy" widgetVar="closingDate">
									</p:calendar>
							
						
							
<!-- 								<h:outputText value="Categories" />	<br/> -->
								<div id="treeDiv" style="position:relative; border: 0px solid #fff;height: 97%;">
								<p>Select a category</p>
									<h:form class="tree-frm" id="tree-frm" >
										<p:tree value="#{itemsBean.contentCategory.categoryTree.root}" var="node" selectionMode="single"
											selection="#{itemsBean.contentCategory.categoryTree.selectedNode}" id="tree" >
											<p:ajax event="select" listener="#{itemsBean.contentCategory.onNodeSelect}"
												/>
											<p:treeNode>
												<h:outputText value="#{node.getNameCategory()}" />
											</p:treeNode>
										</p:tree>
									</h:form>
								</div> 
										<h:outputText value="" />
										<br/>	<br/>	<br/>	<br/>	<br/>	<br/>
								<p:commandButton id="insert"
									actionListener="#{itemsBean.insert}" update="tabView:form:dataTableItems  msgGrowl"
									value="Save"/>
								<p:commandButton id="cancelButton" update="tabView:form"
									rendered="#{itemsBean.renderedInsertButton}"
									value="Cancel" />	
							
							<h:outputText value="" />
							<h:outputText value="" />
								
							<p:messages id="msgs"/>
							<p:growl id="msgGrowl"/>

							</h:panelGrid>
				
						</p:dialog>

					</h:form>
				</div>
			</div>
		</p:layoutUnit>
	</p:layout>
</ui:composition>