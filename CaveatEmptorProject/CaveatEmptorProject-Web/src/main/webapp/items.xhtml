<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<f:metadata>
		<f:viewParam name="userId" value="#{itemsBean.userId}"
			converter="javax.faces.Long"></f:viewParam>
	</f:metadata>

	<p:layout style="width:100%;height:600px;">
 
		<p:layoutUnit position="center">
			<div id="wrapper_create_item">
				<div id="container_create_item">
					<h:form id="frmDropDown" style="padding-left:15px;">
						<p:outputLabel for="dropDownItems" value="Items to: " />
						<h:selectOneMenu id="dropDownItems" value="#{itemsBean.optionDropDown}">
							<f:selectItem itemLabel=" Sell " itemValue="sell" />
							<f:selectItem itemLabel=" Buy " itemValue="buy" />
							<p:ajax event="change"
								update="tabView:frmDropDown:frmContentItems:dataTableItems"
								process="@this" listener="#{itemsBean.onDropDownChange}" />
						</h:selectOneMenu>

						<h:form id="frmContentItems" style="padding-left:15px;">
							<h:outputText for="createItem" value="     " />

							<br />
							<br />
					
							<p:dataTable id="dataTableItems" var="item" rows="10" paginator="true"
								value="#{itemsBean.itemsListDto}" sortMode="multiple"  editable="true">
								
								<p:ajax event="rowEdit" listener="#{itemsBean.onRowEdit}" 	process="@this" update="tabView:frmDropDown:frmContentItems:dataTableItems" onerror="PF('dlgVarEdit').hide()"/>
 								<p:ajax event="rowEditCancel" listener="#{itemsBean.onRowCancel}" process="@this" update="tabView:frmDropDown:frmContentItems:dataTableItems tabView:frmDropDown:frmContentItems:dataTableItems:message"/>
       
								<f:facet name="header">
           							Items to #{itemsBean.optionDropDown}
       							 </f:facet>

								<p:column headerText="Name" sortBy="#{item.name}">
								<p:cellEditor >
								  <h:outputText value="#{item.name}"/>
									<f:facet name="output"><h:outputText value="#{item.name}"/></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputName" value="#{item.name}" style="width:96%" required="true" requiredMessage="Empty Name column.Value is required!" label="Name" >	
                 					</p:inputText>
                 					
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Categories" sortBy="#{item.categories}">
								<p:cellEditor >
									<f:facet name="output"><h:outputText value="#{item.categories}"/></f:facet>
                 					<f:facet name="input">
                 					<p:commandLink id="modelCategName" value="#{item.categories}" style="width:96%" required="true" readonly="true" onclick="PF('dlgChooseCategory').show()">	
                 	
                 					</p:commandLink>
<!--                  					<p:commandLink id="categoryInput" value="#{item.categories}" readonly="true" style="text-decoration:none;" onclick="PF('dlgChooseCategory').hide()"></p:commandLink> -->
                 					
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Initial price (€)" sortBy="#{item.initialPrice}" >
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.initialPrice}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputInitialPrice" value="#{item.initialPrice}" style="width:96%" requiredMessage="Wrong format for Initial price column.Only digits are allowed!" label="InitialPrice" >			
                 					</p:inputText>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Best bid (€)" sortBy="#{item.bestBid}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.bestBid}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputBestBid" value="#{item.bestBid}" style="width:96%" requiredMessage="Wrong format for Best Bid column.Only digits are allowed!" label="BestBid" >				
                 					</p:inputText>
                 					</f:facet>
								</p:cellEditor>
								</p:column>
								
								<p:column headerText="My bid (€)" sortBy="#{item.yourBid}" rendered="#{itemsBean.renderedMyBid}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.yourBid}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputYourBid" value="#{item.yourBid}" style="width:96%" requiredMessage="Wrong format for My Bid column.Only digits are allowed!" label="myBid" >
                 					 </p:inputText>      		
                 					</f:facet>
                 					
								</p:cellEditor>
								
								</p:column>

								<p:column headerText="Bids" sortBy="#{item.nrBids}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.nrBids}" /></f:facet>
                 					<f:facet name="input">
                 					<p:inputText id="modelInputNrBids" value="#{item.nrBids}" style="width:96%" requiredMessage="Wrong format for Bids column.Only numbers are allowed!" label="bids"  >			
                 					</p:inputText>
                 					</f:facet>
								
								</p:cellEditor>
								</p:column>

								<p:column headerText="Opening date" sortBy="#{item.biddingStartDate}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.biddingStartDate}" /></f:facet>
                 					<f:facet name="input">
                 					<p:calendar id="modelInputBiddingStartDate" required="true" value="#{item.biddingStartDate}" style="width:96%" pattern="MM/dd/yyyy" requiredMessage="Empty Opening date column.Select a date!" label="openingDate" >
                 					</p:calendar>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Closing date" sortBy="#{item.biddingEndDate}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.biddingEndDate}" /></f:facet>
                 					<f:facet name="input">
                 					<p:calendar id="modelInputBiddingEndDate" required="true" value="#{item.biddingEndDate}" style="width:96%" pattern="MM/dd/yyyy" requiredMessage="Empty Closing date column.Select a date!" label="closingDate">
                 					</p:calendar>
                 					</f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Status" sortBy="#{item.status}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.status}" /></f:facet>
                 					<f:facet name="input"><p:inputText id="modelInputBiddingStatus" value="#{item.status}" style="width:96%"/></f:facet>
								</p:cellEditor>
								</p:column>

								<p:column headerText="Winner" sortBy="#{item.winner}">
								<p:cellEditor>
									<f:facet name="output"><h:outputText value="#{item.winner}" /></f:facet>
                 					<f:facet name="input"><p:inputText id="modelInputWinner" value="#{item.winner}" style="width:96%"/></f:facet>
								</p:cellEditor>
								</p:column>
								
								<p:column style="width:50px">
								
							
								<p:rowEditor rendered="#{item.renderedEdit}" id="editor">   
								</p:rowEditor >
<!-- 									<p:commandButton icon="ui-icon-trash" title="Delete this item" update="tabView:frmDropDown:frmContentItems:dataTableItems" actionListener="#{itemsBean.delete(item)}" ajax="true" /> -->
								
   				 				<p:growl id="message" showDetail="false"/>   				 							
								<p:dialog id="dialogEdit" height="150" width="300" widgetVar="dlgVarEdit" closable="true">
								<div>
								<br/>
									 	<h:outputText style="margin-left:10px;" value=" Do you want to update this item ?"/>
									 			 <br/><br/><br/>
									 	<p:commandButton value="Yes" action="#{itemsBean.updateItem}" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
       									<h:outputText value=" "/>
       									<p:commandButton value="No" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
								
								</div>
							 	</p:dialog>
							 	
 								<p:dialog id="dialogDelete" height="150" width="300" widgetVar="dlgVarDelete" >
 								<div>
									<br/>
									 	<h:outputText style="margin-left:10px;" value=" Do you want to delete this item ?"/>
									 			 <br/><br/><br/>
									 	<p:commandButton value="Yes" action="#{itemsBean.insertItem}" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
       									<h:outputText value=" "/>
       									<p:commandButton value="No" update="tabView:frmDropDown:frmContentItems:dataTableItems"/>
								
									</div>
									</p:dialog>
									
									
									
									
									<p:dialog id="dlgChooseCategory" height="530px" width="440px" widgetVar="dlgChooseCategory"  style="margin-top:-80px">
 										
										<br/>
									 		<h:outputText style="margin-left:10px;" value=" Choose a category "/>
									 			 <br/><br/><br/>
									 			 
									 			 	<div id="treeDiv">
														<h:form class="tree-form" id="tree-form">
															<p:tree value="#{itemsBean.contentCategory.categoryTree.root}" var="node" selectionMode="single"
																selection="#{treeBean.selectedNode}" id="tree" style="height:260px;width: 400px;">
																<p:ajax event="select" listener="#{itemsBean.contentCategory.onNodeSelect}"
																	update=":tabView:frmDropDown:frmContentItems:dataTableItems:modelCategName" />
																<p:treeNode>
																	<h:outputText value="#{node.getNameCategory()}" />
																</p:treeNode>
															</p:tree>
															<p:commandButton value="OK" update=":tabView:frmDropDown:frmContentItems:dataTableItems" style="margin: 333px 0px 0px 180px;"/>	
														</h:form>
													</div>
									 			 
									 			 	 <br/><br/> 
									
									</p:dialog>
									
							    </p:column>
							</p:dataTable>
							
						</h:form>

					</h:form>
				</div>
			</div>
				
		</p:layoutUnit>
		<p:layoutUnit position="south">

		</p:layoutUnit>
	</p:layout>
</ui:composition>